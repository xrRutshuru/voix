<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title>Amplifying the voices of the cultural leaders in the Rutshuru territory</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <meta property="og:title"
        content="Amplifying the voices of the cultural leaders in the Rutshuru territory of the Democratic Republic of the Congo" />
    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="" />
    <meta property="og:description"
        content="Looking beyond the armed conflict, the struggle for resources, and the fortress conservation, this platform frames the territory from the perspective of its cultural leaders, whose voice is crucial to building a peaceful future and achieving social and ecological justice" />
    <meta property="og:image" content="" />
    <meta property="og:url" content="" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="" />
    <meta name="twitter:title"
        content="Amplifying the voices of the cultural leaders in the Rutshuru territory of the Democratic Republic of the Congo" />
    <meta name="twitter:description"
        content="Looking beyond the armed conflict, the struggle for resources, and the fortress conservation, this platform frames the territory from the perspective of its cultural leaders, whose voice is crucial to building a peaceful future and achieving social and ecological justice" />
    <meta name="twitter:image" content="" />
    <link rel="icon" type="image/x-icon" href="./images/xr.jpg">
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.css' rel='stylesheet' />
    <script src="https://unpkg.com/intersection-observer@0.12.0/intersection-observer.js"></script>
    <script src="https://unpkg.com/scrollama"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/style.css" />
    <style>
    </style>
</head>

<body>

    <div id="map"></div>

    <div id='second' class='legend'>
        <div><span id="block" style='background-color: rgba(255,255,255, 0)'></span><span id="text"
                style="font-weight: bold;">Ressources exploitées</span></div>
        <div style="margin-top: 8px"><span id="block" style='background-color: #ff0000'></span><span
                id="text">Tourmaline</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #ee005f;'></span><span
                id="text">Manganèse</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #b62a8f'></span><span
                id="text">Coltan</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #fcf1c0'></span><span id="text">Or</span>
        </div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #6d4b9a'></span><span
                id="text">Cassitérite</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #325082'></span><span
                id="text">Wolframite</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #0082ff'></span><span
                id="text">Diamant</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #487e91'></span><span
                id="text">Améthyste</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #c2f9ff'></span><span id="text">Mineral
                Mixtes</span></div>
        <div style="margin-top: 15px"><span id="block2"
                style='background-color: rgba(255,255,255, 0.6); border: 1px solid black;'></span><span
                id="text">Concessions pétrolière</span></div>
    </div>

    <div id='third' class='legend'>
        <div><span id="block" style='background-color: rgba(255,255,255, 0)'></span><span id="text"
                style="font-weight: bold;">Groupes rebelles et armés (2020)</span></div>
        <div style="margin-top: 8px"><span id="block" style='background-color: #5cb4c1'></span><span id="text">Nyatura
                GAV</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #52a2c7;'></span><span id="text">Nyatura
                Delta FDDH</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #618dc2'></span><span
                id="text">NDC-R/Guidon</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #7c73b0'></span><span id="text">Nyatura
                Turarambiewe (Rutshuru)</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #935890'></span><span
                id="text">NDC-R/Bwira</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #983e64'></span><span id="text">Mai-Mai
                Jackson MFP</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #f9f971'></span><span id="text">Nyatura
                FPDH</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #bef287'></span><span
                id="text">M23</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #a34100'></span><span id="text">MAC,
                ex-Guides</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #00323d'></span><span id="text">Nyatura
                Jean-Marie</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #e5feff'></span><span
                id="text">FLDR-FOCA</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #cd9b7e'></span><span
                id="text">RUD-Urunana</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #f9f971'></span><span id="text">Nyatura
                FPDH</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #e68fb4'></span><span id="text">Mai-Mai
                Kabidon FPP/AP</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #bba758'></span><span
                id="text">AFRC</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #eee8aa'></span><span id="text">Amka
                Jeshi</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #96b1b6'></span><span
                id="text">APCLS</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #ff8e3d'></span><span
                id="text">Nyatura-APRDC</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #a34100'></span><span id="text">Nyatura
                FPPH</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #852800'></span><span id="text">Nyatura
                Bagaruza</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #f9f971'></span><span id="text">Nyatura
                FPDH</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #006e7a'></span><span id="text">Nyatura
                Nyatura Musheku</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #b8ffff'></span><span id="text">Nyatura
                CMC</span></div>
    </div>

    <div id='fourth' class='legend'>
        <div><span id="block2" style='background-color: #e3e874;'></span><span id="text">Parc national des
                Virunga</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #598849'></span><span id="text">Postes de
                patrouille - Rangers du parc national des Virunga</span></div>
    </div>

    <!-- <div id='fifth' class='legend'>
        <div><span id="block" style='background-color: rgba(255,255,255, 0)'></span><span id="text"
                style="font-weight: bold;">Groupes ethniques (1960)</span></div>
        <div style="margin-top: 8px"><span id="block" style='background-color: #73216a'></span><span id="text">Nande
                (Yira)</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #386fa3;'></span><span
                id="text">Banyabwisha</span></div>
        <div style="margin-top: 5px"><span id="block" style='background-color: #f35959'></span><span
                id="text">Hunde</span></div>
    </div> -->


    <div id="mapInset"></div>
    <div id="story"></div>

    <script src="./config-en.js"></script>
    <script>
        var initLoad = true;
        var layerTypes = {
            'fill': ['fill-opacity'],
            'line': ['line-opacity'],
            'circle': ['circle-opacity', 'circle-stroke-opacity'],
            'symbol': ['icon-opacity', 'text-opacity'],
            'raster': ['raster-opacity'],
            'fill-extrusion': ['fill-extrusion-opacity'],
            'heatmap': ['heatmap-opacity']
        }

        var alignments = {
            'left': 'lefty',
            'center': 'centered',
            'right': 'righty',
            'full': 'fully'
        }

        function getLayerPaintType(layer) {
            var layerType = map.getLayer(layer).type;
            return layerTypes[layerType];
        }

        function setLayerOpacity(layer) {
            var paintProps = getLayerPaintType(layer.layer);
            paintProps.forEach(function (prop) {
                var options = {};
                if (layer.duration) {
                    var transitionProp = prop + "-transition";
                    options = { "duration": layer.duration };
                    map.setPaintProperty(layer.layer, transitionProp, options);
                }
                map.setPaintProperty(layer.layer, prop, layer.opacity, options);
            });
        }

        var story = document.getElementById('story');
        var features = document.createElement('div');
        features.setAttribute('id', 'features');

        var header = document.createElement('div');

        if (config.title) {
            var titleText = document.createElement('h1');
            titleText.innerText = config.title;
            header.appendChild(titleText);
        }

        if (config.subtitle) {
            var subtitleText = document.createElement('h2');
            subtitleText.innerText = config.subtitle;
            header.appendChild(subtitleText);
        }

        if (config.byline) {
            var bylineText = document.createElement('p');
            bylineText.innerHTML = config.byline;
            header.appendChild(bylineText);
        }

        if (header.innerText.length > 0) {
            header.classList.add(config.theme);
            header.setAttribute('id', 'header');
            story.appendChild(header);
        }

        config.chapters.forEach((record, idx) => {
            var container = document.createElement('div');
            var chapter = document.createElement('div');

            if (record.title) {
                var title = document.createElement('h3');
                title.innerText = record.title;
                chapter.appendChild(title);
            }

            if (record.image) {
                var image = new Image();
                image.src = record.image;
                chapter.appendChild(image);
            }

            if (record.description) {
                var story = document.createElement('h3');
                story.innerHTML = record.description;
                chapter.appendChild(story);
            }

            container.setAttribute('id', record.id);
            container.classList.add('step');
            if (idx === 0) {
                container.classList.add('active');
            }

            chapter.classList.add(config.theme);
            container.appendChild(chapter);
            container.classList.add(alignments[record.alignment] || 'centered');
            if (record.hidden) {
                container.classList.add('hidden');
            }
            features.appendChild(container);
        });

        story.appendChild(features);

        var footer = document.createElement('div');

        if (config.footer) {
            var footerText = document.createElement('p');
            footerText.innerHTML = config.footer;
            footer.appendChild(footerText);
        }

        if (footer.innerText.length > 0) {
            footer.classList.add(config.theme);
            footer.setAttribute('id', 'footer');
            story.appendChild(footer);
        }

        mapboxgl.accessToken = config.accessToken;

        const transformRequest = (url) => {
            const hasQuery = url.indexOf("?") !== -1;
            const suffix = hasQuery ? "&pluginName=scrollytellingV2" : "?pluginName=scrollytellingV2";
            return {
                url: url + suffix
            }
        }

        var map = new mapboxgl.Map({
            container: 'map',
            style: config.style,
            center: config.chapters[0].location.center,
            zoom: config.chapters[0].location.zoom,
            bearing: config.chapters[0].location.bearing,
            pitch: config.chapters[0].location.pitch,
            interactive: false,
            transformRequest: transformRequest,
            projection: config.projection
        });

        // Create a inset map if enabled in config.js
        if (config.inset) {
            var insetMap = new mapboxgl.Map({
                container: 'mapInset', // container id
                style: 'mapbox://styles/mapbox/dark-v10', //hosted style id
                center: config.chapters[0].location.center,
                // Hardcode above center value if you want insetMap to be static.
                zoom: 5, // starting zoom
                hash: false,
                interactive: false,
                attributionControl: false,
                //Future: Once official mapbox-gl-js has globe view enabled,
                //insetmap can be a globe with the following parameter.
                //projection: 'globe'
            });
        }

        if (config.showMarkers) {
            var marker = new mapboxgl.Marker({ color: config.markerColor });
            marker.setLngLat(config.chapters[0].location.center).addTo(map);
        }

        // instantiate the scrollama
        var scroller = scrollama();


        map.on("load", function () {
            if (config.use3dTerrain) {
                map.addSource('mapbox-dem', {
                    'type': 'raster-dem',
                    'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
                    'tileSize': 512,
                    'maxzoom': 14
                });
                map.addSource('story-first', {
                    type: 'geojson',
                    data: 'data/stories.geojson',
                    generateId: true // This ensures that all features have unique IDs
                });
                // add the DEM source as a terrain layer with exaggerated height
                map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.5 });

                // add a sky layer that will show when the map is highly pitched
                map.addLayer({
                    'id': 'sky',
                    'type': 'sky',
                    'paint': {
                        'sky-type': 'atmosphere',
                        'sky-atmosphere-sun': [0.0, 0.0],
                        'sky-atmosphere-sun-intensity': 15
                    }
                });
                map.addLayer({
                    id: 'story-first-viz',
                    type: 'circle',
                    source: 'story-first',
                    paint: {
                        'circle-radius': {
                            'stops': [
                                [9, 0],
                                [9.5, 0],
                                [10, 5]
                            ]
                        },
                        'circle-stroke-color': [
                            'match',
                            ['get', 'id'],
                            'First',
                            '#256D85',
                        /* other */ '#ccc'
                        ],
                        'circle-stroke-width': {
                            'stops': [
                                [9, 0],
                                [9.5, 0],
                                [10, 5]
                            ]
                        },
                        'circle-color': "rgba(255, 0, 0, 0)",
                    }
                });
            };

            // As the map moves, grab and update bounds in inset map.
            if (config.inset) {
                map.on('move', getInsetBounds);
            }
            // setup the instance, pass callback functions
            scroller
                .setup({
                    step: '.step',
                    offset: 0.5,
                    progress: true
                })
                .onStepEnter(async response => {
                    var chapter = config.chapters.find(chap => chap.id === response.element.id);

                    var chapterid = chapter.id;
                    console.log(chapterid);

                    if (chapterid == "slug-style-id") {
                        $("#second").hide();
                        $("#third").hide();
                        $("#fourth").hide();
                        // $("#fifth").hide();
                        // $("#mapa8legend").hide();
                        // $("#mapa10legend").hide();
                        // $("#mapa11legend").hide();
                    }

                    if (chapterid == "second-identifier") {
                        $("#second").show();
                        $("#third").hide();
                        $("#fourth").hide();
                        // $("#fifth").hide();
                        // $("#mapa8legend").hide();
                        // $("#mapa10legend").hide();
                        // $("#mapa11legend").hide();
                    }

                    if (chapterid == "third-identifier") {
                        $("#second").hide();
                        $("#third").show();
                        $("#fourth").hide();
                        // $("#fifth").hide();
                        // $("#mapa8legend").hide();
                        // $("#mapa10legend").hide();
                        // $("#mapa11legend").hide();
                    }

                    if (chapterid == "fourth-chapter") {
                        $("#second").hide();
                        $("#third").hide();
                        $("#fourth").show();
                        // $("#fifth").hide();
                        // $("#mapa8legend").hide();
                        // $("#mapa10legend").hide();
                        // $("#mapa11legend").hide();
                    }

                    if (chapterid == "fifth-chapter") {
                        $("#second").hide();
                        $("#third").hide();
                        $("#fourth").hide();
                        // $("#fifth").show();
                        // $("#mapa8legend").hide();
                        // $("#mapa10legend").hide();
                        // $("#mapa11legend").hide();
                    }


                    response.element.classList.add('active');
                    map[chapter.mapAnimation || 'flyTo'](chapter.location);
                    // Incase you do not want to have a dynamic inset map,
                    // rather want to keep it a static view but still change the
                    // bbox as main map move: comment out the below if section.
                    if (config.inset) {
                        if (chapter.location.zoom < 5) {
                            insetMap.flyTo({ center: chapter.location.center, zoom: 0 });
                        }
                        else {
                            insetMap.flyTo({ center: chapter.location.center, zoom: 3 });
                        }
                    }
                    if (config.showMarkers) {
                        marker.setLngLat(chapter.location.center);
                    }
                    if (chapter.onChapterEnter.length > 0) {
                        chapter.onChapterEnter.forEach(setLayerOpacity);
                    }
                    if (chapter.callback) {
                        window[chapter.callback]();
                    }
                    if (chapter.rotateAnimation) {
                        map.once('moveend', () => {
                            const rotateNumber = map.getBearing();
                            map.rotateTo(rotateNumber + 180, {
                                duration: 30000, easing: function (t) {
                                    return t;
                                }
                            });
                        });
                    }
                })
                .onStepExit(response => {
                    var chapter = config.chapters.find(chap => chap.id === response.element.id);
                    response.element.classList.remove('active');
                    if (chapter.onChapterExit.length > 0) {
                        chapter.onChapterExit.forEach(setLayerOpacity);
                    }
                });
        });

        //Helper functions for insetmap
        function getInsetBounds() {
            let bounds = map.getBounds();

            let boundsJson = {
                "type": "FeatureCollection",
                "features": [{
                    "type": "Feature",
                    "properties": {},
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [
                            [
                                [
                                    bounds._sw.lng,
                                    bounds._sw.lat
                                ],
                                [
                                    bounds._ne.lng,
                                    bounds._sw.lat
                                ],
                                [
                                    bounds._ne.lng,
                                    bounds._ne.lat
                                ],
                                [
                                    bounds._sw.lng,
                                    bounds._ne.lat
                                ],
                                [
                                    bounds._sw.lng,
                                    bounds._sw.lat
                                ]
                            ]
                        ]
                    }
                }]
            }

            if (initLoad) {
                addInsetLayer(boundsJson);
                initLoad = false;
            } else {
                updateInsetLayer(boundsJson);
            }

        }

        function addInsetLayer(bounds) {
            insetMap.addSource('boundsSource', {
                'type': 'geojson',
                'data': bounds
            });

            insetMap.addLayer({
                'id': 'boundsLayer',
                'type': 'fill',
                'source': 'boundsSource', // reference the data source
                'layout': {},
                'paint': {
                    'fill-color': '#fff', // blue color fill
                    'fill-opacity': 0.2
                }
            });
            // // Add a black outline around the polygon.
            insetMap.addLayer({
                'id': 'outlineLayer',
                'type': 'line',
                'source': 'boundsSource',
                'layout': {},
                'paint': {
                    'line-color': '#000',
                    'line-width': 1
                }
            });
        }

        function updateInsetLayer(bounds) {
            insetMap.getSource('boundsSource').setData(bounds);
        }





        // setup resize event
        window.addEventListener('resize', scroller.resize);

    </script>

</body>

</html>